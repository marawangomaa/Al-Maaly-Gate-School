<div class="register-page d-flex min-vh-100">
  <!-- Left: Visual -->
  <div class="register-visual">
    <img
      src="assets/images/register.png"
      alt="Register Visual"
      class="register-bg"
    />
  </div>

  <!-- Right: Form -->
  <div
    class="register-content d-flex align-items-center justify-content-center"
  >
    <div
      class="register-form w-100"
      style="max-width: 450px; position: relative"
    >
      <div class="text-center mb-4">
        <img
          src="assets/images/logo.png"
          alt="Logo"
          class="register-logo mb-3"
        />
        <h2 class="fw-bold main-title">{{ "REGISTER.TITLE" | translate }}</h2>
      </div>

      <!-- Error -->
      @if (errorMessage) {
      <div class="alert alert-danger text-center py-2 mb-3">
        <i class="bi bi-exclamation-triangle me-2"></i>
        {{ errorMessage }}
      </div>
      }

      <!-- Success -->
      @if (successMessage) {
      <div class="alert alert-success text-center py-2 mb-3">
        <i class="bi bi-check-circle me-2"></i>
        {{ successMessage }}
      </div>
      }

      <!-- File Error -->
      @if (fileError) {
      <div class="alert alert-warning text-center py-2 mb-3">
        <i class="bi bi-exclamation-circle me-2"></i>
        {{ fileError }}
      </div>
      }

      <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
        <!-- Full Name -->
        <div class="mb-3">
          <label class="form-label"
            >{{ "REGISTER.FULLNAME" | translate }} *</label
          >
          <input
            type="text"
            formControlName="fullName"
            class="form-control cool-input"
            [placeholder]="'REGISTER.FULLNAME_PLACEHOLDER' | translate"
            [class.is-invalid]="
              registerForm.get('fullName')?.invalid &&
              registerForm.get('fullName')?.touched
            "
          />
          @if (registerForm.get('fullName')?.invalid &&
          registerForm.get('fullName')?.touched) {
          <div class="text-danger small mt-1">
            {{ "REGISTER.FULLNAME_MIN_ERROR" | translate }}
          </div>
          }
        </div>

        <!-- Username -->
        <div class="mb-3">
          <label class="form-label"
            >{{ "REGISTER.USERNAME" | translate }} *</label
          >
          <input
            type="text"
            formControlName="userName"
            class="form-control cool-input"
            [placeholder]="'REGISTER.USERNAME_PLACEHOLDER' | translate"
            [class.is-invalid]="
              registerForm.get('userName')?.invalid &&
              registerForm.get('userName')?.touched
            "
          />
          @if (registerForm.get('userName')?.invalid &&
          registerForm.get('userName')?.touched) {
          <div class="text-danger small mt-1">
            {{ "REGISTER.USERNAME_MIN_ERROR" | translate }}
          </div>
          }
        </div>

        <!-- Email -->
        <div class="mb-3">
          <label class="form-label">{{ "REGISTER.EMAIL" | translate }} *</label>
          <input
            type="email"
            formControlName="email"
            class="form-control cool-input"
            [placeholder]="'REGISTER.EMAIL_PLACEHOLDER' | translate"
            [class.is-invalid]="
              registerForm.get('email')?.invalid &&
              registerForm.get('email')?.touched
            "
          />
          @if (registerForm.get('email')?.invalid &&
          registerForm.get('email')?.touched) {
          <div class="text-danger small mt-1">
            {{ "REGISTER.EMAIL_INVALID" | translate }}
          </div>
          }
        </div>

        <!-- Contact Info -->
        <div class="mb-3">
          <label class="form-label">{{
            "REGISTER.CONTACT_INFO" | translate
          }}</label>
          <input
            type="text"
            formControlName="contactInfo"
            class="form-control cool-input"
            [placeholder]="'REGISTER.CONTACT_PLACEHOLDER' | translate"
            [class.is-invalid]="
              registerForm.get('contactInfo')?.invalid &&
              registerForm.get('contactInfo')?.touched
            "
          />
          @if (registerForm.get('contactInfo')?.invalid &&
          registerForm.get('contactInfo')?.touched) {
          <div class="text-danger small mt-1">
            {{ "REGISTER.CONTACT_MIN_ERROR" | translate }}
          </div>
          }
        </div>

        <!-- Password -->
        <div class="mb-3">
          <label class="form-label"
            >{{ "REGISTER.PASSWORD" | translate }} *</label
          >
          <input
            type="password"
            formControlName="password"
            class="form-control cool-input"
            [placeholder]="'REGISTER.PASSWORD_PLACEHOLDER' | translate"
            [class.is-invalid]="
              registerForm.get('password')?.invalid &&
              registerForm.get('password')?.touched
            "
          />
          @if (registerForm.get('password')?.invalid &&
          registerForm.get('password')?.touched) {
          <div class="text-danger small mt-1">
            {{ "REGISTER.PASSWORD_MIN_ERROR" | translate }}
          </div>
          }
        </div>

        <!-- Confirm Password -->
        <div class="mb-3">
          <label class="form-label"
            >{{ "REGISTER.CONFIRM_PASSWORD" | translate }} *</label
          >
          <input
            type="password"
            formControlName="confirmPassword"
            class="form-control cool-input"
            [placeholder]="'REGISTER.CONFIRM_PASSWORD_PLACEHOLDER' | translate"
            [class.is-invalid]="registerForm.get('confirmPassword')?.errors?.['mismatch']"
          />
          @if (registerForm.get('confirmPassword')?.errors?.['mismatch']) {
          <div class="text-danger small mt-1">
            {{ "REGISTER.PASSWORD_MISMATCH" | translate }}
          </div>
          }
        </div>

        <!-- Role -->
        <div class="mb-3">
          <label class="form-label">{{ "REGISTER.ROLE" | translate }} *</label>
          <select
            class="form-select cool-input"
            formControlName="role"
            [class.is-invalid]="
              registerForm.get('role')?.invalid &&
              registerForm.get('role')?.touched
            "
          >
            <option value="">{{ "REGISTER.ROLE_SELECT" | translate }}</option>
            <option value="student">
              {{ "REGISTER.ROLE_STUDENT" | translate }}
            </option>
            <option value="teacher">
              {{ "REGISTER.ROLE_TEACHER" | translate }}
            </option>
            <option value="parent">
              {{ "REGISTER.ROLE_PARENT" | translate }}
            </option>
          </select>
          @if (registerForm.get('role')?.invalid &&
          registerForm.get('role')?.touched) {
          <div class="text-danger small mt-1">
            {{ "REGISTER.ROLE_REQUIRED" | translate }}
          </div>
          }
        </div>

        <!-- Parent-specific fields -->
        @if (registerForm.get('role')?.value === 'parent') {
        <div class="parent-section border rounded p-3 mb-3 bg-light">
          <h6 class="mb-3 text-primary">
            <i class="bi bi-person-badge me-2"></i>
            {{ "REGISTER.PARENT_INFO" | translate }}
          </h6>
          <!-- Relation to Student -->
          <div class="mb-3">
            <label class="form-label"
              >{{ "REGISTER.RELATION" | translate }} *</label
            >
            <select
              class="form-select cool-input"
              formControlName="relation"
              [class.is-invalid]="
                registerForm.get('relation')?.invalid &&
                registerForm.get('relation')?.touched
              "
            >
              <option value="">
                {{ "REGISTER.RELATION_SELECT" | translate }}
              </option>
              <option value="father">
                {{ "REGISTER.RELATION_FATHER" | translate }}
              </option>
              <option value="mother">
                {{ "REGISTER.RELATION_MOTHER" | translate }}
              </option>
              <option value="guardian">
                {{ "REGISTER.RELATION_GUARDIAN" | translate }}
              </option>
              <option value="other">
                {{ "REGISTER.RELATION_OTHER" | translate }}
              </option>
            </select>
            @if (registerForm.get('relation')?.invalid &&
            registerForm.get('relation')?.touched) {
            <div class="text-danger small mt-1">
              {{ "REGISTER.RELATION_REQUIRED" | translate }}
            </div>
            }
          </div>

          <!-- Document Upload -->
          <div class="mb-3">
            <label class="form-label">
              <i class="bi bi-file-earmark-arrow-up me-1"></i>
              {{ "REGISTER.DOCUMENTS_TITLE" | translate }}
            </label>
            <div class="file-upload-container border rounded p-3">
              <!-- File Input (Hidden) -->
              <input
                type="file"
                #fileInput
                multiple
                accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                (change)="onFileSelected($event)"
                class="form-control cool-input"
                style="display: none"
              />

              <!-- Upload Button -->
              <div class="text-center mb-3">
                <button
                  type="button"
                  class="btn btn-primary btn-sm"
                  (click)="fileInput.click()"
                  [disabled]="selectedFiles.length >= 3"
                >
                  <i class="bi bi-cloud-upload me-2"></i>
                  {{
                    selectedFiles.length === 0
                      ? ("REGISTER.SELECT_DOCUMENTS" | translate)
                      : ("REGISTER.ADD_MORE_DOCUMENTS" | translate)
                  }}
                </button>
                <small class="d-block text-muted mt-1">
                  {{ "REGISTER.FIRST_FILE_IDENTITY" | translate }}
                </small>
              </div>

              <!-- File Requirements -->
              <div class="alert alert-info py-2 mb-3">
                <small>
                  <i class="bi bi-info-circle me-1"></i>
                  <strong>{{ "REGISTER.REQUIREMENTS" | translate }}:</strong>
                  {{ "REGISTER.FILE_REQUIREMENTS_DETAIL" | translate }}
                </small>
              </div>

              <!-- Selected Files List -->
              @if (selectedFiles.length > 0) {
              <div class="selected-files">
                <h6 class="mb-2">
                  {{ "REGISTER.SELECTED_FILES" | translate }}:
                </h6>
                @for (file of selectedFiles; track $index; let first = $first) {
                <div
                  class="file-item d-flex align-items-center justify-content-between mb-2 p-2 border rounded"
                  [class.bg-light]="first"
                >
                  <div class="file-info d-flex align-items-center">
                    <i
                      class="bi"
                      [class]="
                        first
                          ? 'bi-file-earmark-text-fill text-primary'
                          : 'bi-file-earmark-text'
                      "
                    ></i>
                    <div class="ms-2">
                      <div class="file-name">
                        {{ file.name }}
                        @if (first) {
                        <span class="badge bg-primary ms-2">
                          {{ "REGISTER.IDENTITY_BADGE" | translate }}
                        </span>
                        }
                      </div>
                      <small class="text-muted">{{
                        formatFileSize(file.size)
                      }}</small>
                    </div>
                  </div>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-danger"
                    (click)="removeFile($index)"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
                }
              </div>
              } @else {
              <div class="text-center text-muted py-3">
                <i class="bi bi-file-earmark-excel display-6"></i>
                <p class="mt-2">{{ "REGISTER.NO_DOCUMENTS" | translate }}</p>
              </div>
              }

              <!-- File Count -->
              @if (selectedFiles.length > 0) {
              <div class="mt-3 text-center">
                <span
                  class="badge"
                  [class]="
                    selectedFiles.length === 3 ? 'bg-danger' : 'bg-success'
                  "
                >
                  {{
                    "REGISTER.FILES_COUNT"
                      | translate : { current: selectedFiles.length, max: 3 }
                  }}
                </span>
              </div>
              }
            </div>
          </div>
        </div>
        }

        <!-- Submit Button -->
        <div class="d-grid gap-2">
          <button
            class="btn btn-primary btn-lg"
            type="submit"
            [disabled]="isLoading || registerForm.invalid"
          >
            @if (isLoading) {
            <span
              class="spinner-border spinner-border-sm me-2"
              role="status"
              aria-hidden="true"
            ></span>
            {{ "REGISTER.LOADING" | translate }}
            } @else {
            <i class="bi bi-person-plus me-2"></i>
            {{ "REGISTER.SUBMIT" | translate }}
            }
          </button>

          <button
            type="button"
            class="btn btn-outline-secondary"
            (click)="onCancel()"
            [disabled]="isLoading"
          >
            <i class="bi bi-x-circle me-2"></i>
            {{ "REGISTER.CANCEL" | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
